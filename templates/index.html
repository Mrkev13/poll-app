{% extends "base.html" %}
{% block title %}Anketa — Hlasování{% endblock %}

{% block content %}

{% if already_voted %}
  <div class="flash info">☕ Už jsi hlasoval(a). Tady jsou aktuální výsledky:</div>
{% endif %}

{% if votes is not none %}
  {# ── VÝSLEDKY (po hlasování nebo pro toho kdo hlasoval dříve) ── #}
  <div class="options">
    {% for opt in poll.options %}
      {% set count = votes[opt.id] %}
      {% set pct = (count / total * 100) | round(1) if total > 0 else 0 %}
      <div class="result-row {% if voted == opt.id %}voted-option{% endif %}">
        <div class="result-top">
          <span class="option-letter">{{ opt.label }}</span>
          <span class="option-text">{{ opt.text }}</span>
          <span style="font-size:.85rem;font-weight:500;min-width:3.5rem;text-align:right">{{ pct }}%</span>
        </div>
        <div class="result-bar-wrap">
          <div class="result-bar"></div>
        </div>
        <div class="result-counts">{{ count }} hlasů</div>
      </div>
    {% endfor %}
  </div>
  <p class="total">Celkem hlasů: {{ total }}</p>

  {% if not already_voted %}
    <div class="actions">
      <a href="{{ url_for('index') }}" class="btn btn-outline">← Zpět na anketu</a>
    </div>
  {% endif %}

{% else %}
  {# ── HLASOVACÍ FORMULÁŘ ── #}
  <form action="{{ url_for('vote') }}" method="post">
    <div class="options">
      {% for opt in poll.options %}
        <label class="option-label">
          <input type="radio" name="option" value="{{ opt.id }}" required>
          <span class="option-letter">{{ opt.label }}</span>
          <span class="option-text">{{ opt.text }}</span>
        </label>
      {% endfor %}
    </div>
    <div class="actions">
      <button type="submit" class="btn btn-primary">Hlasovat →</button>
      <a href="{{ url_for('results') }}" class="btn btn-outline">Zobrazit výsledky</a>
    </div>
  </form>
{% endif %}

<hr class="divider">
<div class="reset-section">
  <details>
    <summary>Správa ankety — reset hlasování</summary>
    <form action="{{ url_for('reset') }}" method="post" class="reset-form">
      <input type="password" name="token" placeholder="Zadej reset token…" autocomplete="off">
      <button type="submit" class="btn btn-danger">Resetovat</button>
    </form>
  </details>
</div>

{% endblock %}
